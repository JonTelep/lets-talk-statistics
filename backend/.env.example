# ============================================================================
# Crime Statistics API - Environment Configuration
# ============================================================================
# Copy this file to .env and update with your actual values
# ============================================================================

# ============================================================================
# Application Settings
# ============================================================================
APP_NAME=Crime Statistics API
APP_VERSION=1.0.0
DEBUG=false
ENVIRONMENT=production
HOST=0.0.0.0
PORT=8000

# ============================================================================
# Supabase Configuration
# ============================================================================
# Get these from: https://app.supabase.com > Project Settings > API Keys
#
# API Keys come in two formats (both work):
#   - New format: sb_publishable_... (client) / sb_secret_... (backend)
#   - Legacy format: anon key (client) / service_role key (backend)
#
SUPABASE_URL=https://[PROJECT-REF].supabase.co
SUPABASE_ANON_KEY=your-publishable-or-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-secret-or-service-role-key

# ============================================================================
# Database Configuration (Supabase PostgreSQL via Supavisor)
# ============================================================================
# Get connection strings from: Click "Connect" button in project dashboard
#
# Supavisor offers two pooling modes:
#   - Transaction mode (port 6543): For serverless/edge, does NOT support prepared statements
#   - Session mode (port 5432): For persistent backends, supports prepared statements
#
# Transaction mode pooler (port 6543) - USE THIS FOR APPLICATION
# IMPORTANT: Must include ?prepared_statement_cache_size=0 (Supavisor transaction mode requirement)
DATABASE_URL=postgresql+asyncpg://postgres.[PROJECT-REF]:your-password@aws-0-[REGION].pooler.supabase.com:6543/postgres?prepared_statement_cache_size=0

# Session mode pooler (port 5432) - USE THIS FOR MIGRATIONS
# Supports prepared statements, ideal for Alembic migrations
DATABASE_URL_DIRECT=postgresql+asyncpg://postgres.[PROJECT-REF]:your-password@aws-0-[REGION].pooler.supabase.com:5432/postgres

# ============================================================================
# Connection Pool Settings
# ============================================================================
# These settings are used for direct connections (not pooled)
DATABASE_POOL_SIZE=10
DATABASE_POOL_MAX_OVERFLOW=20
DATABASE_POOL_PRE_PING=true
DATABASE_POOL_RECYCLE=3600

# ============================================================================
# Redis Configuration
# ============================================================================
# Option 1: Self-hosted Redis on VPS (recommended for cost)
REDIS_URL=redis://localhost:6379/0

# Option 2: Upstash Redis (serverless)
# REDIS_URL=rediss://default:your-password@us1-steady-mantis-12345.upstash.io:6379

# Option 3: Redis Cloud
# REDIS_URL=redis://default:your-password@redis-12345.c1.us-east-1-2.ec2.cloud.redislabs.com:12345

# ============================================================================
# Celery Configuration
# ============================================================================
# Use same Redis instance or separate databases
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# ============================================================================
# Data Storage
# ============================================================================
# Local storage path for downloaded CSV files
# For VPS: /var/lib/crime_stats/storage/raw_data
# For local dev: ./storage/raw_data
DATA_STORAGE_PATH=./storage/raw_data

# ============================================================================
# FBI Crime Data Explorer API
# ============================================================================
FBI_CDE_BASE_URL=https://cde.ucr.cjis.gov
# Get API key from: https://cde.ucr.cjis.gov/LATEST/webapp/#/pages/docApi
FBI_API_KEY=your-fbi-api-key-here

# ============================================================================
# Logging
# ============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json

# ============================================================================
# API Configuration
# ============================================================================
API_V1_PREFIX=/api/v1

# CORS Origins (JSON array format)
# For production, use your actual domain(s)
CORS_ORIGINS=["https://your-domain.com","https://www.your-domain.com"]

# For local development, use:
# CORS_ORIGINS=["http://localhost:3000","http://localhost:8000"]

# ============================================================================
# Scheduled Tasks Configuration
# ============================================================================
# Cron format: minute hour day month day_of_week
# Default: September 1st at 3 AM (after FBI annual data release)
DATA_UPDATE_SCHEDULE=0 3 1 9 *

# ============================================================================
# Statistics Calculation
# ============================================================================
# Base population for per capita calculations (default: per 100,000 people)
PER_CAPITA_BASE=100000

# ============================================================================
# Notes
# ============================================================================
# 1. Never commit .env file to version control
# 2. Keep production credentials secure
# 3. Use different databases for dev/staging/production
# 4. Rotate API keys and passwords regularly
# 5. Enable Supabase Point-in-Time Recovery (PITR) for backups
